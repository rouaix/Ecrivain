<h2>Consommation IA</h2>

<div style="display: flex; gap: 20px; margin-bottom: 30px;">
    <repeat group="{{ @stats }}" value="{{ @item }}">
        <div class="stat-card">
            <h3>{{ @item.model_name }}</h3>
            <p class="stat-value">{{ number_format(@item.total_tokens, 0,
                ',', ' ') }}
                <span class="stat-sub">tokens</span>
            </p>
            <div class="stat-details">
                <div>Requêtes : {{ @item.request_count }}</div>
                <div>Prompt : {{ number_format(@item.total_prompt, 0, ',', ' ') }}</div>
                <div>Réponse : {{ number_format(@item.total_completion, 0, ',', ' ') }}</div>
                <div style="margin-top:5px; font-weight:bold; color: #2196F3;">Coût estimé : ~ {{
                    number_format(@item.estimated_cost, 4, ',', ' ') }} $</div>
            </div>
        </div>
    </repeat>
</div>

<h3>Historique récent</h3>
<table class="data-table">
    <thead>
        <tr>
            <th>Date</th>
            <th>Modèle</th>
            <th>Fonctionnalité</th>
            <th style="text-align: right;">Prompt</th>
            <th style="text-align: right;">Réponse</th>
            <th style="text-align: right;">Total</th>
        </tr>
    </thead>
    <tbody>
        <repeat group="{{ @recent }}" value="{{ @entry }}">
            <tr>
                <td>{{ date('d/m/Y H:i', strtotime(@entry.created_at)) }}</td>
                <td>{{ @entry.model_name }}</td>
                <td>{{ @entry.feature_name }}</td>
                <td style="text-align: right;">{{ number_format(@entry.prompt_tokens, 0, ',', ' ') }}
                </td>
                <td style="text-align: right;">{{ number_format(@entry.completion_tokens, 0, ',', ' ') }}
                </td>
                <td style="text-align: right; font-weight: bold;">{{ number_format(@entry.total_tokens,
                    0, ',', ' ')
                    }}</td>
            </tr>
        </repeat>
        <check if="empty(@recent)">
            <tr>
                <td colspan="6" style="padding: 20px; text-align: center; color: var(--text-muted);">Aucun usage
                    enregistré pour le
                    moment.</td>
            </tr>
        </check>
    </tbody>
</table>

<div style="margin-top: 20px;">
    <a href="{{ @base }}/dashboard" class="button secondary">Retour au tableau de bord</a>
</div>