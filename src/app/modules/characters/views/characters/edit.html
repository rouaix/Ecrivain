<h2>Modifier le personnage « {{ @character.name }}»</h2>
<p><a class="button" href="{{ @base }}/project/{{ @project.id }}/characters">Retour à la liste des
        personnages</a></p>
<check if="{{ !empty(@errors) }}">
    <div class="error">
        <ul>
            <repeat group="{{ @errors }}" value="{{ @err }}">
                <li>{{ @err }}</li>
            </repeat>
        </ul>
    </div>
</check>
<form method="post"
    action="{{ @character.id ? (@base . '/character/' . @character.id . '/edit') : (@base . '/project/' . @project.id . '/character/create') }}">
    <input type="hidden" name="csrf_token" value="{{ @csrfToken }}">
    <div class="form-group">
        <label for="name">Nom *</label>
        <input type="text" id="name" name="name" value="{{ @character.name }}" required>
    </div>
    <div id="editor-wrapper" style="display: flex; gap: 20px; align-items: flex-start;">
        <div class="form-group" style="flex: 1;">
            <label for="description">Description (enrichie)</label>
            <div id="editor" style="height: 300px; background: white; color: black;">
                {{ @character.description | raw }}
            </div>
            <input type="hidden" name="description" value="{{ @character.description | esc }}">
            <p style="margin-top: 10px;">Compteur de mots : <span id="wordCount">0</span></p>
            <div class="editor-tools-wrapper">
                <button type="button" id="synButton">Synonymes (IA)</button>
                <button type="button" id="continueButton" class="button-ai-purple">Continuer (IA)</button>
                <button type="button" id="rephraseButton" class="button-ai-purple">Reformuler (IA)</button>
                <button type="button" id="analysisButton">Analyse du texte</button>
                <div id="status" style="display:inline-block; margin-left:10px; color:green;"></div>
                <div id="synonymsBox" class="ai-box"></div>
                <div id="analysisBox" class="ai-box"></div>
            </div>
        </div>

    </div>
    </div>

    <input type="submit" value="Enregistrer">
</form>

<!-- AI Modal Structure -->
<div id="aiModal" class="ai-modal">
    <h3>Proposition IA</h3>
    <textarea id="aiModalText"
        style="width:100%; height:300px; margin-bottom:10px; background:var(--input-bg); color:var(--input-text); border:1px solid var(--input-border);"></textarea>
    <div class="ai-modal-actions">
        <button id="aiBtnInsert" class="button-ai-green">Insérer au curseur</button>
        <button id="aiBtnReplace" class="button-ai-orange">Remplacer la sélection</button>
        <button id="aiBtnCopy">Copier</button>
        <button id="aiBtnClose">Fermer</button>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        QuillTools.init('#editor', {
            inputSelector: 'input[name="description"]',
            baseUrl: '{{ @base }}',
            csrfToken: '{{ @csrfToken }}',
            contextId: '{{ @character.id }}',
            contextType: 'character'
        });
    });
</script>