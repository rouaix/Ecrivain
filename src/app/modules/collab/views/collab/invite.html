<div class="edit-page-layout">
    <div class="edit-header">
        <h2><i class="fas fa-users"></i> Collaborateurs — {{ @project.title | esc }}</h2>
        <div class="header-actions">
            <a href="{{ @base }}/project/{{ @project.id }}" class="button secondary">
                <i class="fas fa-arrow-left"></i> Retour au projet
            </a>
        </div>
    </div>

    <check if="{{ count(@errors) > 0 }}">
        <div class="alert alert-error">
            <repeat group="{{ @errors }}" value="{{ @err }}">
                <p>{{ @err | esc }}</p>
            </repeat>
        </div>
    </check>

    <!-- Inviter un collaborateur -->
    <div class="card" style="margin-bottom:1.5rem">
        <h3 style="margin-top:0"><i class="fas fa-user-plus"></i> Inviter un collaborateur</h3>
        <p class="text-muted-para">L'utilisateur doit déjà posséder un compte. Il recevra une invitation qu'il pourra accepter ou refuser.</p>
        <form method="post" action="{{ @base }}/project/{{ @project.id }}/collaborateurs/invite">
            <input type="hidden" name="csrf_token" value="{{ @csrfToken }}">
            <div class="form-row" style="display:flex;gap:.75rem;align-items:flex-end">
                <div class="form-group" style="flex:1;margin:0">
                    <label for="collabEmail">Adresse e-mail</label>
                    <input type="email" id="collabEmail" name="email" class="input-control" placeholder="collaborateur@exemple.com" required>
                </div>
                <button type="submit" class="button primary">Envoyer l'invitation</button>
            </div>
        </form>
    </div>

    <!-- Liste des collaborateurs -->
    <div class="card">
        <h3 style="margin-top:0"><i class="fas fa-list"></i> Collaborateurs actuels</h3>
        <check if="{{ count(@collaborators) == 0 }}">
            <p class="text-muted-para">Aucun collaborateur invité pour l'instant.</p>
        </check>
        <check if="{{ count(@collaborators) > 0 }}">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Utilisateur</th>
                        <th>E-mail</th>
                        <th>Statut</th>
                        <th>Invité le</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <repeat group="{{ @collaborators }}" value="{{ @c }}">
                        <tr>
                            <td>{{ @c.username | esc }}</td>
                            <td>{{ @c.email | esc }}</td>
                            <td>
                                <check if="{{ @c.status == 'accepted' }}"><span class="badge badge-success">Accepté</span></check>
                                <check if="{{ @c.status == 'pending' }}"><span class="badge badge-warning">En attente</span></check>
                                <check if="{{ @c.status == 'declined' }}"><span class="badge badge-error">Refusé</span></check>
                            </td>
                            <td>{{ @c.created_at }}</td>
                            <td>
                                <form method="post" action="{{ @base }}/project/{{ @project.id }}/collaborateurs/{{ @c.user_id }}/remove"
                                      onsubmit="return confirm('Retirer ce collaborateur ?')">
                                    <input type="hidden" name="csrf_token" value="{{ @csrfToken }}">
                                    <button type="submit" class="button small delete">Retirer</button>
                                </form>
                            </td>
                        </tr>
                    </repeat>
                </tbody>
            </table>
        </check>
    </div>

    <!-- Lien vers la file de revue -->
    <div style="margin-top:1rem">
        <a href="{{ @base }}/project/{{ @project.id }}/collab/demandes" class="button secondary">
            <i class="fas fa-inbox"></i> Voir les demandes des collaborateurs
        </a>
    </div>
</div>
