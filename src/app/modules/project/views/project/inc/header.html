<div class="project-page professional-show">
    <section class="project-hero {{ !@stats.has_content ? 'small' : '' }}">
        <div class="project-hero__cover {{ !@stats.has_content ? 'small' : '' }}">
            <check if="{{ isset(@project.cover_image) && @project.cover_image }}">
                <true>
                    <img src="{{ @base }}/project/{{ @project.id }}/cover">
                </true>
                <false>
                    <div class="project-hero__cover-placeholder">
                        <span>Couverture indisponible</span>
                    </div>
                </false>
            </check>

        </div>
        <div class="project-hero__body">
            <div class="project-hero__heading">
                <h1>{{ @project.title }}</h1>
            </div>
            <check if="{{ !empty(@project.description) }}">
                <true>
                    <div class="project-hero__description">{{ nl2br(@project.description) }}</div>
                </true>
            </check>
            <check if="{{ !empty(@authorName) }}">
                <div class="project-hero__author">{{ @authorName }}</div>
            </check>
            <div class="project-hero__actions">
                <div class="project-hero__actions-group">
                    <a class="button" href="{{ @base }}/project/{{ @project.id }}/mindmap">Carte mentale</a>
                    <a class="button" href="{{ @base }}/project/{{ @project.id }}/lecture">Lecture</a>
                    <a class="button" href="{{ @base }}/project/{{ @project.id }}/relecture">Relecture</a>
                </div>
                <div class="project-hero__actions-group">
                    <button class="button" id="export-modal-open">Exporter ▾</button>
                </div>

                <div id="export-modal" class="modal-overlay">
                    <div class="modal-content" style="max-width:480px">
                        <div class="modal-header export-modal-header">
                            <h3>Exporter le projet</h3>
                            <button class="modal-close button" id="export-modal-close">✕</button>
                        </div>
                        <div class="modal-body">
                            <ul class="export-options-list">
                                <li>
                                    <a class="button" href="{{ @base }}/project/{{ @project.id }}/export">Texte (.txt)</a>
                                    <span class="export-format-desc">Texte brut formaté, titres en majuscules</span>
                                </li>
                                <li>
                                    <a class="button" href="{{ @base }}/project/{{ @project.id }}/export/markdown">Markdown (.md)</a>
                                    <span class="export-format-desc">Format Markdown avec titres # et mise en forme</span>
                                </li>
                                <li>
                                    <a class="button" href="{{ @base }}/project/{{ @project.id }}/export/html">HTML (.html)</a>
                                    <span class="export-format-desc">Document web complet avec styles CSS</span>
                                </li>
                                <li>
                                    <a class="button" href="{{ @base }}/project/{{ @project.id }}/export/epub">EPUB (.epub)</a>
                                    <span class="export-format-desc">Format liseuse numérique</span>
                                </li>
                                <li>
                                    <a class="button" href="{{ @base }}/project/{{ @project.id }}/export/vector">JSON (.json)</a>
                                    <span class="export-format-desc">Pour vectorisation et traitement IA</span>
                                </li>
                                <li>
                                    <a class="button" href="{{ @base }}/project/{{ @project.id }}/export/clean">Texte brut (.txt)</a>
                                    <span class="export-format-desc">Tout en minuscules, sans mise en forme</span>
                                </li>
                                <li>
                                    <a class="button" href="{{ @base }}/project/{{ @project.id }}/export/summaries">Résumés (.txt)</a>
                                    <span class="export-format-desc">Titres et résumés uniquement</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <check if="{{ @stats.has_content }}">
                <true>
                    <div class="project-hero__metrics">
                        <article class="metric-card">
                            <span class="metric-label">Objectif</span>
                            <strong>{{ @stats.pages_target }} pages</strong>
                            <span class="metric-sub">{{ @stats.target_words }} mots prévus</span>
                        </article>
                        <article class="metric-card">
                            <span class="metric-label">Progression</span>
                            <strong>{{ @stats.progress_percent }}% achevé</strong>
                            <span class="metric-sub">{{ @stats.pages_current }} / {{ @stats.pages_target }} pages •
                                {{ @stats.total_words }} mots</span>
                        </article>
                        <article class="metric-card">
                            <span class="metric-label">Ressources</span>
                            <strong>{{ @stats.note_count }} notes</strong>
                            <span class="metric-sub">Personnages : {{ @stats.character_count }} • Sections :
                                {{ @stats.before_count }} avant / {{ @stats.after_count }} après</span>
                        </article>
                    </div>
                    <div class="project-hero__progress">
                        <div class="progress-track">
                            <div class="progress-bar" data-progress="{{ @stats.progress_percent }}"></div>
                        </div>
                        <p class="project-hero__progress-note">
                            ({{ @stats.wpp }} mots par page • {{ @stats.lpp }} lignes par page)
                        </p>
                    </div>
                </true>
            </check>

        </div>
    </section>
    <div id="saveStatus" class="save-status">Ordre enregistré !</div>
</div>
<script nonce="{{ @nonce }}">
(function () {
    var modal = document.getElementById('export-modal');
    document.getElementById('export-modal-open').addEventListener('click', function () {
        modal.classList.add('is-visible');
    });
    document.getElementById('export-modal-close').addEventListener('click', function () {
        modal.classList.remove('is-visible');
    });
    modal.addEventListener('click', function (e) {
        if (e.target === modal) modal.classList.remove('is-visible');
    });
})();
</script>